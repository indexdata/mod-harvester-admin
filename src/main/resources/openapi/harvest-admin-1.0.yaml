openapi: 3.1.0
info:
  title: Harvester Admin API
  version: v0.1
paths:
  /harvester-admin/harvestables:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    post:
      description: Create harvest job configuration
      operationId: postHarvestable
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/harvestablePostPut"
        required: true
      responses:
        "201":
          description: Harvest definition created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/harvestableGet"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    get:
      description: Get brief harvest job definitions
      operationId: getHarvestables
      parameters:
      - in: query
        name: query
        required: false
        description: CQL
        schema:
          type: string
      responses:
        "200":
          description: Harvest job definitions returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/harvestables"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/xml-bulk:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    post:
      description: Create bulk XML harvest job configuration
      operationId: postHarvestableXmlBulk
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/harvestableXmlBulkPostPut"
        required: true
      responses:
        "201":
          description: XML bulk harvest definition created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/harvestableGet"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/oai-pmh:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    post:
      description: Create OAI-PMH harvest job configuration
      operationId: postHarvestableOaiPmh
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/harvestableOaiPmhPostPut"
        required: true
      responses:
        "201":
          description: OAI-PMH harvest definition created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/harvestableGet"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
    get:
      operationId: getHarvestable
      description: Get harvest configuration
      responses:
        "200":
          description: Harvest configuration returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/harvestableGet"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putHarvestable
      description: Update harvest configuration
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/harvestablePostPut"
        required: true
      responses:
        "204":
          description: No content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteHarvestable
      description: Delete a harvest job configuration
      responses:
        "204":
          description: Harvest job configuration deleted
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/xml-bulk/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
    put:
      operationId: putHarvestableXmlBulk
      description: Update bulk XML harvest configuration
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/harvestableXmlBulkPostPut"
        required: true
      responses:
        "204":
          description: No content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/oai-pmh/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
    put:
      operationId: putHarvestableOaiPmh
      description: Update OAI-PMH harvest configuration
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/harvestableOaiPmhPostPut"
        required: true
      responses:
        "204":
          description: No content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/jobs/run/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
    put:
      operationId: startJob
      description: Starts a harvest job immediately if possible
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/jobStarted"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/jobs/stop/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
    put:
      operationId: stopJob
      description: Stops a harvest job
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/jobStopped"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"


  /harvester-admin/harvestables/{id}/log:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
      - in: query
        name: offset
        required: false
        description: log file start line
        schema:
          type: string
      - in: query
        name: limit
        required: false
        description: max log file lines
        schema:
          type: string

    get:
      operationId: getJobLog
      description: Get log statements for a harvest job
      responses:
        "200":
          description: Harvest log statements returned
          content:
            text/plain:
              schema:
                type: string
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/{id}/failed-records:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
      - in: query
        name: offset
        required: false
        description: result set start row
        schema:
          type: string
      - in: query
        name: limit
        required: false
        description: result set max rows
        schema:
          type: string

    get:
      operationId: getFailedRecords
      description: Get failed records for a harvest job
      responses:
        "200":
          description: Harvest failed records list returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/failedRecordsCurrentJob"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/{id}/failed-records/{num}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
      - in: path
        name: num
        required: true
        description: number of a failed record
        schema:
          type: string

    get:
      operationId: getFailedRecord
      description: Get a failed record for a harvest job
      responses:
        "200":
          description: error report for failed record
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/failedRecordCurrentJob"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/harvestables/{id}/log/store:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest configuration identifier
        schema:
          type: number
    post:
      description: Takes submitted job status, pulls the job config, and stores a copy of its most recent logs
      operationId: storeJobLogWithPostedStatus
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/harvestJobStatus"
        required: true
      responses:
        "200":
          description: Harvest log statements stored in module storage
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    get:
      operationId: storeJobLog
      description: Pulls the current job config from Harvester and stores a copy of the most recent log for that job
      responses:
        "200":
          description: Harvest log statements stored in module storage
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/previous-jobs:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      operationId: getPreviousJobs
      description: Retrieves list of previous harvest jobs
      parameters:
        - in: query
          name: query
          required: false
          description: CQL query, supporting harvestableId, name, type, status, message, and amountHarvested in queries, and the same fields plus started and finished in sorting
          schema:
            type: string
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: string
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: string
        - in: query
          name: from
          required: false
          description: date range start parameter on finished date
          schema:
            type: string
        - in: query
          name: until
          required: false
          description: date range end parameter on finished date
          schema:
            type: string
      responses:
        "200":
          description: List of previous harvest jobs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/previousJobs"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      description: Create job log samples for test purposes etc, for example by import from another FOLIO instance.
      operationId: postPreviousJob
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/previousJob"
        required: true
      responses:
        "201":
          description: Job log created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/previousJob"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"


  /harvester-admin/previous-jobs/failed-records:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    get:
      operationId: getFailedRecordsForPreviousJobs
      description: Retrieves the failed records of previous harvest jobs
      parameters:
        - in: query
          name: query
          required: false
          description: CQL query, supporting recordNumber, harvestableId, harvestableName in queries
          schema:
            type: string
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: string
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: string
        - in: query
          name: from
          required: false
          description: date range parameter on error report timestamp
          schema:
            type: string
        - in: query
          name: until
          required: false
          description: date range parameter on error report timestamp
          schema:
            type: string
      responses:
        "200":
          description: List of failed records for previous harvest jobs
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/failedRecordsPreviousJob"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/previous-jobs/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest job identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getPreviousJob
      description: Retrieves details of a previous harvest job
      responses:
        "200":
          description: A previous harvest job
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/previousJob"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deletePreviousJob
      description: Delete a previous job run with all its logs
      responses:
        "200":
          description: Job run and logs deleted
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"


  /harvester-admin/previous-jobs/{id}/log:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest job identifier
        schema:
          type: string
          format: uuid
    get:
      operationId: getPreviousJobLog
      description: Retrieves the log of a previous harvest job
      parameters:
        - in: query
          name: query
          required: false
          description: CQL, supporting harvestJobId, logLevel, jobLabel, line in query terms
          schema:
            type: string
      responses:
        "200":
          description: Logs for a previous harvest job
          content:
            text/plain:
              schema:
                type: string
            application/json:
              schema:
                $ref: "#/components/schemas/logLines"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

    post:
      operationId: postPreviousJobLog
      description: Backdoor for creating logs of a previous harvest job without running a job
      requestBody:
        content:
          text/plain:
            schema:
              type: string
        required: true
      responses:
        "201":
          description: Logs for a previous harvest job created
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/previous-jobs/{id}/failed-records:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Harvest job identifier
        schema:
          type: string
          format: uuid

    get:
      operationId: getFailedRecordsForPreviousJob
      description: Retrieves the failed records of a previous harvest job
      parameters:
        - in: query
          name: query
          required: false
          description: CQL query, supporting recordNumber, harvestableId, harvestableName in queries
          schema:
            type: string
        - in: query
          name: from
          required: false
          description: date range parameter on error report timestamp
          schema:
            type: string
        - in: query
          name: until
          required: false
          description: date range parameter on error report timestamp
          schema:
            type: string
        - in: query
          name: offset
          required: false
          description: result set start row
          schema:
            type: string
        - in: query
          name: limit
          required: false
          description: result set max rows
          schema:
            type: string
      responses:
        "200":
          description: List of failed records for a previous harvest job
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/failedRecordsPreviousJob"

        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

    post:
      description: Create failed record samples without running a job, for example to import from another FOLIO instance.
      operationId: postFailedRecords
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/failedRecordsPreviousJob"
        required: true
      responses:
        "201":
          description: Failed record entries created
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"


  /harvester-admin/previous-jobs/failed-records/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: UUID of the failed-record object
        schema:
          type: string
          format: uuid
    get:
      operationId: getFailedRecordForPreviousJob
      description: Retrieves a failed record of a previous harvest job
      responses:
        "200":
          description: A failed record object
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/storages:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    post:
      description: Create storage configuration
      operationId: postStorage
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/storage"
        required: true
      responses:
        "201":
          description: Storage definition created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/storage"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    get:
      description: Get brief storage definitions
      operationId: getStorages
      parameters:
        - in: query
          name: query
          required: false
          description: CQL
          schema:
            type: string
      responses:
        "200":
          description: Storage definitions returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/storages"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/storages/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Storage definition identifier
        schema:
          type: integer
    get:
      operationId: getStorage
      description: Get storage definition
      responses:
        "200":
          description: Storage definitions returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/storage"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putStorage
      description: Update storage definition
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/storage"
        required: true
      responses:
        "204":
          description: No content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteStorage
      description: Delete a storage definition
      responses:
        "204":
          description: Storage definition deleted
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/transformations:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
    post:
      description: Create transformation pipeline
      operationId: postTransformation
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformationPostPut"
        required: true
      responses:
        "201":
          description: Transformation definition created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationGet"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    get:
      description: Get brief transformation definitions
      operationId: getTransformations
      parameters:
        - in: query
          name: query
          required: false
          description: CQL
          schema:
            type: string
      responses:
        "200":
          description: Transformation pipelines returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformations"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/transformations/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Transformation pipeline identifier
        schema:
          type: integer
    get:
      operationId: getTransformation
      description: Get transformation pipeline
      responses:
        "200":
          description: Transformation pipelines returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationGet"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putTransformation
      description: Update transformation definition
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformationPostPut"
        required: true
      responses:
        "204":
          description: No content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteTransformation
      description: Delete a transformation pipeline
      responses:
        "204":
          description: Transformation pipeline deleted
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/steps:
    get:
      operationId: getSteps
      description: Get brief transformation step definition records
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/steps"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      operationId: postStep
      description: Create new transformation step definition
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/step"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/step"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteSteps
      description: Delete all transformation step definitions
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/steps/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Step identifier
        schema:
          type: string
    get:
      operationId: getStep
      description: Get detailed transformation step definition record
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/step"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putStep
      description: Update a transformation step definition
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/step"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/step"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteStep
      description: Delete a transformation step definition
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/steps/{id}/script:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Step identifier
        schema:
          type: string
    get:
      operationId: getScript
      description: Get transformation step script
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                $ref: "#/components/schemas/script"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putScript
      description: Update a transformation step script
      requestBody:
        content:
          text/plain:
            schema:
              type: string
      responses:
        "204":
          description: OK, no content
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/tsas:
    get:
      operationId: getTsas
      description: Get transformation step associations
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociations"
        "500":
          $ref: "#/components/responses/trait_500"
    post:
      operationId: postTsa
      description: Create new transformation step association
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformationStepAssociation"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociation"
        "400":
          $ref: "#/components/responses/trait_400"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteTsas
      description: Delete all transformation step associations
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/tsas/{id}:
    parameters:
      - $ref: "#/components/parameters/okapi_tenant"
      - $ref: "#/components/parameters/okapi_token"
      - $ref: "#/components/parameters/okapi_url"
      - in: path
        name: id
        required: true
        description: Association identifier
        schema:
          type: string
    get:
      operationId: getTsa
      description: Get a transformation step association
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociation"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    put:
      operationId: putTsa
      description: Update a transformation step association
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/transformationStepAssociation"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/transformationStepAssociation"
        "400":
          $ref: "#/components/responses/trait_400"
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"
    delete:
      operationId: deleteTsa
      description: Delete a transformation step association
      responses:
        "204":
          description: No content
        "404":
          $ref: "#/components/responses/trait_404"
        "500":
          $ref: "#/components/responses/trait_500"

  /harvester-admin/generate-ids:
    parameters:
      - in: query
        name: count
        required: false
        description: integer, max 100
        schema:
          type: integer
    get:
      operationId: getIds
      description: Get up to 100 random 15 digit numbers
      responses:
        "200":
          description: 15 digit numbers separated by newline
          content:
            text/plain:
              schema:
                type: string

  /harvester-admin/purge-aged-logs:
    post:
      operationId: purgeAgedLogs
      description: Delete old harvest logs from storage
      responses:
        "201":
          description: No content

components:
  parameters:
    okapi_tenant:
      in: header
      name: X-Okapi-Tenant
      description: Okapi Tenant
      required: false
      schema:
        type: string
    okapi_token:
      in: header
      name: X-Okapi-Token
      description: Okapi Token
      required: false
      schema:
        type: string
    okapi_url:
      in: header
      name: X-Okapi-Url
      description: Okapi URL
      required: false
      schema:
        type: string
  responses:
    trait_400:
      description: Bad request
      content:
        text/plain:
          schema:
            type: string
            example: Invalid JSON in request
        application/json:
          schema:
            type: object
            example: {"error":"Invalid JSON in request"}
    trait_404:
      description: Bad request
      content:
        text/plain:
          schema:
            type: string
            example: Not found
    trait_500:
      description: Internal error
      content:
        text/plain:
          schema:
            type: string
            example: Internal server error, contact administrator


  schemas:

    storages:
      description: brief storage configuration records
      type: object
      properties:
        storages:
          description: List of storage definitions
          type: array
          items:
            description: brief storage configuration record
            type: object
            properties:
              id:
                type: integer
                description: unique identifier for the storage configuration
              name:
                type: string
                description: a name assigned to the storage definition
              enabled:
                type: string
                enum:
                  - 'true'
                  - 'false'
                description: >-
                  indicates if this storage definition is available to be used in harvest
                  job definitions
              description:
                type: string
                description: additional descriptions of the storage definition
            additionalProperties: false
        totalRecords:
          description: Total number of records in response
          type: integer
      additionalProperties: false


    storage:
      description: A storage definition
      type: object
      properties:
        acl:
          type: string
          description: System maintained access control string.
          readOnly: true
        id:
          type: string
          description: Unique storage identifier.
        name:
          type: string
          description: Name of the storage definition.
        description:
          type: string
          description: Free text details about the storage definition.
        enabled:
          type: string
          description: Boolean string to indicate if the storage definition can be used.
          enum:
            - 'true'
            - 'false'
          default: 'false'
        bulkSize:
          type: string
          description: Obsolete, constant 1000.
          readOnly: true
        currentStatus:
          type: string
          description: Obsolete, constant NEW.
          readOnly: true
        url:
          type: string
          description: Address of the storage service.
      oneOf:
        - properties:
            type:
              type: string
              description: Type of storage.
              enum:
                - inventoryStorage
            json:
              type: object
              description: Storage configuration parameters in JSON.
          required:
            - json
        - properties:
            type:
              type: string
              description: Type of storage.
              enum:
                - solrStorage
          not:
            required:
              - json

    transformations:
      description: brief transformation configuration records
      type: object
      properties:
        transformations:
          description: List of transformation definitions
          type: array
          items:
            description: brief transformation pipeline record
            type: object
            properties:
              id:
                type: integer
                description: unique identifier for the transformation pipeline
              name:
                type: string
                description: a name assigned to the transformation pipeline
              description:
                type: string
                description: additional text describing this transformation pipeline
              inputFormat:
                type: string
                description: free-text describing the format of input to this transformation step
              outputFormat:
                type: string
                description: >-
                  free-text describing the format of the output from this transformation
                  step
              type:
                type: string
                description: free-text describing what kind of transformation this step performs
            additionalProperties: true

        totalRecords:
          description: Total number of records in response
          type: integer
      additionalProperties: false

    transformationGet:
      description: A transformation pipeline
      type: object
      properties:
        id:
          type: string
          description: Unique record identifier.
        name:
          type: string
          description: Name of the transformation pipeline.
        description:
          type: string
          description: Details about the pipeline.
        type:
          type: string
          description: The type of transformation pipeline.
          enum:
            - basicTransformation
            - customTransformation
        enabled:
          type: string
          description: Indicates if the transformation pipeline can be used by harvest jobs
          enum:
            - 'true'
            - 'false'
        parallel:
          type: string
          description: Indicates if steps should be run concurrently (each in its own thread).
          enum:
            - 'true'
            - 'false'
          default: 'false'
        stepAssociations:
          type: array
          description: The list of transformation steps that makes up the pipeline.
          items:
            type: object
            description: Definition of an associated transformation step.
            properties:
              id:
                type: string
                description: The id for the association.
                pattern: '^[0-9]*$'
              position:
                type: string
                description: >-
                  The sequence number of the step in the ordering of steps in the
                  transformation pipeline.
                pattern: '^[0-9]*$'
              step:
                type: object
                description: Details or the transformation step configuration.
                properties:
                  entityType:
                    type: string
                    description: 'Type of step, XSLT or custom'
                    enum:
                      - xmlTransformationStep
                      - customTransformationStep
                  acl:
                    type: string
                    description: Then tenant that created this step.
                  description:
                    type: string
                    description: Free text; administrators notes about the step.
                  inputFormat:
                    type: string
                    description: >-
                      Free text; informational; the format of the record before this
                      step, id 'XML'
                  name:
                    type: string
                    description: The name assigned to the step.
                  outputFormat:
                    type: string
                    description: >-
                      Free text; informational; the format of the record after this
                      step.
                  script:
                    type: string
                    description: >-
                      Would by the XSLT script, if any, but omitted in the context of
                      a harvestable.
                    enum:
                      - <'script' omitted from nested displays>
                      - ''
                  customClass:
                    type: string
                    description: >-
                      For 'customTransformationStep': Fully qualified name of the
                      Harvester class processing this step.
                  id:
                    type: string
                    description: Unique ID for the step.
                    pattern: '^[0-9]*$'
                  testData:
                    type: string
                    description: >-
                      Would be source XML for testing XSLT script but omitted in context of a harvestable.
                    enum:
                      - <'testData' omitted from nested displays>
                      - ''
                  testOutput:
                    type: string
                    description: >-
                      Would be the resulting XML from running the script on `testData`
                      but omitted in context of a harvestable.
                    enum:
                      - <'testOutput' omitted from nested displays>
                      - ''
              transformation:
                type: string
                description: The ID of the transformation that the step is part of.
                pattern: '^[0-9]*$'

    transformationPostPut:
      description: A transformation pipeline
      type: object
      properties:
        id:
          type: string
          description: Unique record identifier.
        acl:
          type: string
          description: System controlled access control string.
          readOnly: true
        name:
          type: string
          description: Name of the transformation pipeline.
        description:
          type: string
          description: Details about the pipeline.
        type:
          type: string
          description: The type of transformation pipeline.
          enum:
            - basicTransformation
            - customTransformation
        enabled:
          type: string
          description: Indicates if the transformation pipeline can be used by harvest jobs
          enum:
            - 'true'
            - 'false'
        parallel:
          type: string
          description: Indicates if steps should be run concurrently (each in its own thread).
          enum:
            - 'true'
            - 'false'
          default: 'false'
        stepAssociations:
          type: array
          description: >-
            List of steps that make up the transformation pipeline. In a POST this
            will be used for attaching the steps to the pipeline. In a PUT this is
            ignored.
          items:
            type: object
            anyOf:
              - properties:
                  position:
                    type: string
                    description: >-
                      The steps position in the sequence of steps, starting with
                      number 1.
                  step:
                    type: object
                    description: >-
                      Existing transformation step to include in pipeline, referenced by ID or step name.
                    anyOf:
                      - properties:
                          id:
                            type: string
                            description: >-
                              The step's numeric id. In a POST it is used for looking up the step and attaching it.
                      - properties:
                          name:
                            type: string
                            description: >-
                              An alternative to the ID for look-up and attachment. Used in a POST if no ID is present.
                required:
                  - step
              - properties:
                  position:
                    type: string
                    description: >-
                      The steps position in the sequence of steps, starting with
                      number 1.
                  stepId:
                    type: string
                    description: >-
                      The step's numeric id. In a POST it is used for looking up the
                      step and attaching it.
                required:
                  - stepId
              - properties:
                  position:
                    type: string
                    description: >-
                      The steps position in the sequence of steps, starting with
                      number 1.
                  stepName:
                    type: string
                    description: >-
                      An alternative to the ID for look-up and attachment. Used in a
                      POST if no ID is present.
                required:
                  - stepName
      required:
        - name
        - type
      additionalProperties: false

    steps:
      description: brief transformation step records
      type: object
      properties:
        steps:
          description: List of transformation step definitions
          type: array
          items:
            description: brief transformation step configuration record
            type: object
            properties:
              id:
                type: integer
                description: unique identifier for the transformation step
              name:
                type: string
                description: a name assigned to the transformation step
              enabled:
                type: string
                description: >-
                  indicates if this storage definition is available to be used in harvest
                  job definitions
              description:
                type: string
                description: additional descriptions of the storage definition
            additionalProperties: false
        totalRecords:
          description: Total number of records in response
          type: integer
      additionalProperties: false

    step:
      description: Transformation step configuration record
      type: object
      properties:
        acl:
          type: string
          description: System controlled access control string.
          readOnly: true
        id:
          type: string
          description: Unique identifier for the transformation step.
        name:
          type: string
          description: A name assigned to the transformation step.
        enabled:
          type: string
          description: >-
            Indicates if this step is available to be used in a transformation
            pipeline.
          default: 'false'
        description:
          type: string
          description: Additional descriptions of the storage definition.
        type:
          type: string
          description: Type of transformation step.
          enum:
            - XmlTransformStep
            - CustomTransformStep
        inputFormat:
          type: string
          description: Free-text indication of the format of input data to the step.
        outputFormat:
          type: string
          description: Free-text indication of the format of the resulting output from the step.
        testData:
          type: string
          description: Sample input data for testing.
        testOutput:
          type: string
          description: Output from testing using the sample test-data.
        customClass:
          type: string
          description: >-
            Only CustomTransformSteps: fully qualified class name of the class
            performing the transformation.
        script:
          type: string
          description: 'Transformation script, typically XSLT.'
      additionalProperties: false
      required:
        - name
        - type

    script:
      description: 'Transformation step script (xslt as plain text)'
      type: object
      additionalProperties: true

    harvestables:
      description: Harvest job definitions response
      type: object
      properties:
        harvestables:
          type: array
          items:
            description: Brief harvest job definition record
            type: object
            properties:
              id:
                type: string
                description: Unique ID for the job definition
              name:
                type: string
                description: The name assigned to job
              currentStatus:
                type: string
                description: Indicates the state of the job
                enum:
                  - 'NEW'
                  - 'OK'
                  - 'WARN'
                  - 'ERROR'
                  - 'RUNNING'
                  - 'FINISHED'
                  - 'KILLED'
              enabled:
                type: string
                enum:
                  - 'true'
                  - 'false'
              storageUrl:
                type: string
                description: Address of the storage service where the results of a harvest run should be persisted
              lastHarvestStarted:
                type: string
                description: the date and time when the most recent harvest job with this configuration began
              lastHarvestFinished:
                type: string
                description: the date and time when the most recent harvest job with this configuration completed
              lastUpdated:
                type: string
                description: the date and time when this definition was last modified
              nextHarvestSchedule:
                type: string
                description: the date and time when a job with this definition should be run (if job is enabled)
              jobClass:
                type: string
                description: indicates the type of source from which the job would harvest and thus the kind of processing the Harvester would perform for running the job
                enum:
                  - 'XmlBulkResource'
                  - 'OaiPmhResource'
                  - 'HarvestConnectorResource'
              amountHarvested:
                type: string
                description: Number of records harvested in last run. It seems this should really be an integer, but string is what the WSAPI gives us
              message:
                type: string
                description: Message summarising results of last run

    transformationStepAssociations:
      description: transformation step associations
      type: object
      properties:
        transformationSteps:
          description: List of transformation steps associated with transformation pipelines
          type: array
          items:
            type: object
            $ref: "#/components/schemas/transformationStepAssociation"
        totalRecords:
          description: Total number of records in response
          type: integer
      additionalProperties: false

    transformationStepAssociation:
      description: transformation step association record
      type: object
      properties:
        id:
          type: string
          description: unique identifier for the association
        step:
          type: object
          description: contains id of step that is associated with a pipeline
          properties:
            id:
              type: string
              description: Id of the step associated with a pipeline.
            name:
              type: string
              description: Name for the step associated with a pipeline.
          additionalProperties: true
          anyOf:
            - required:
                - id
            - required:
                - name
        transformation:
          type: string
          description: Id of the transformation pipeline that the step is associated with.
        transformationName:
          type: string
          description: >-
            Transient. Optional alternative to the id for looking up the
            transformation to attach the step to.
        position:
          type: string
          description: >-
            The position of the step amongst other transformation steps in the
            pipeline.
      additionalProperties: false
      required:
        - step
        - position
      anyOf:
        - required:
            - transformation
        - required:
            - transformationName


    harvestableGet:
      description: A harvest job definition
      type: object
      properties:
        id:
          type: string
          description: >-
            Unique, numeric ID for the job definition. Will be assigned if not
            provided.
          pattern: '^[0-9]*$'
        name:
          type: string
          description: The name assigned to the harvest configuration.
        description:
          type: string
          description: Free form description of the configuration to support the administration.
        openAccess:
          type: string
          description: tbd
          enum:
            - 'true'
            - 'false'
        storage:
          type: object
          description: The storage definition used when storing the harvested records.
          properties:
            entityType:
              type: string
              description: Type of storage engine.
              enum:
                - inventoryStorageEntity
                - solrStorageEntity
            bulkSize:
              type: string
              description: Obsolete constant.
            currentStatus:
              type: string
              description: Obsolete constant.
            customClass:
              type: string
              description: Obsolete.
            enabled:
              type: string
              description: Defines if this storage configuration can by used by a harvest job.
              enum:
                - 'true'
                - 'false'
            idAsString:
              type: string
              description: Readonly for internal use in Harvester. Here same value as 'id'.
            name:
              type: string
              description: The name assigned to the storage configuration.
            url:
              type: string
              description: The HTTP address of the storage engine.
        transformation:
          type: object
          description: The transformation pipeline used for the harvest job.
          properties:
            entityType:
              type: string
              description: >-
                The type of transformation (the only existing type is basic
                transformation).
              enum:
                - basicTransformation
            acl:
              type: string
              description: The name of the tenant that created the transformation pipeline.
            description:
              type: string
              description: Free text description of the transformation pipeline.
            enabled:
              type: string
              description: Indicates if the transformation pipeline can be used by harvest jobs
              enum:
                - 'true'
            name:
              type: string
              description: The name assigned to the transformation pipeline.
            parallel:
              type: string
              description: >-
                Indicates if steps should be run concurrently (each in its own
                thread).
              enum:
                - 'true'
                - 'false'
              default: 'false'
            stepAssociations:
              type: array
              description: The list of transformation steps that makes up the pipeline.
              items:
                type: object
                description: Definition of an associated transformation step.
                properties:
                  id:
                    type: string
                    description: The id for the association.
                    pattern: '^[0-9]*$'
                  position:
                    type: string
                    description: >-
                      The sequence number of the step in the ordering of steps in the
                      transformation pipeline.
                    pattern: '^[0-9]*$'
                  step:
                    type: object
                    description: Details or the transformation step configuration.
                    properties:
                      entityType:
                        type: string
                        description: 'Type of step, XSLT or custom'
                        enum:
                          - xmlTransformationStep
                          - customTransformationStep
                      acl:
                        type: string
                        description: Then tenant that created this step.
                      description:
                        type: string
                        description: Free text; administrators notes about the step.
                      inputFormat:
                        type: string
                        description: >-
                          Free text; informational; the format of the record before
                          this step, id 'XML'
                      name:
                        type: string
                        description: The name assigned to the step.
                      outputFormat:
                        type: string
                        description: >-
                          Free text; informational; the format of the record after
                          this step.
                      script:
                        type: string
                        description: >-
                          Would by the XSLT script, if any, but omitted in the context
                          of a harvestable.
                        enum:
                          - <'script' omitted from nested displays>
                          - ''
                      id:
                        type: string
                        description: Unique ID for the step.
                        pattern: '^[0-9]*$'
                      testData:
                        type: string
                        description: >-
                          Would be source XML for testing XSLT script but omitted in
                          context of a harvestable.
                        enum:
                          - <'testData' omitted from nested displays>
                          - ''
                      testOutput:
                        type: string
                        description: >-
                          Would be the resulting XML from running the script on
                          `testData` but omitted in context of a harvestable.
                        enum:
                          - <'testOutput' omitted from nested displays>
                          - ''
                  transformation:
                    type: string
                    description: The ID of the transformation that the step is part of.
                    pattern: '^[0-9]*$'
            id:
              type: string
              description: The ID of the transformation pipeline.
              pattern: '^[0-9]*$'
        enabled:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Indicates if the job is scheduled for running
        harvestImmediately:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Whether to harvest when the config is persisted.
        scheduleString:
          type: string
          description: >-
            Crontab style schedule string (simplified): minute(0-59) hour(0-24)  day
            of month(* or 1-31)  month (* or 1-12)  day of week (* or 0-6).
        dateFormat:
          type: string
          description: 'For example yyyy-MM-dd''T''hh:mm:ss''Z''.'
        url:
          type: string
          description: The URL to access the data from.
        timeout:
          type: string
          description: >-
            Connection/read timeout in seconds; application depending on the specific
            protocol used for fetching data.
          pattern: '^[0-9]*$'
          default: '300'
        cacheEnabled:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Whether or not to store incoming records in Harvester's file system.
        diskRun:
          type: string
          enum:
            - 'true'
            - 'false'
          description: >-
            Whether or not to run harvest job from records cached in a previous job
            run.
        recordLimit:
          type: string
          description: Maximum number of records to harvest.
          pattern: '^[0-9]*$'
        laxParsing:
          type: string
          description: >-
            When enabled, Harvester will attempt to parse malformed XML (missing
            closing tags, entities)
          enum:
            - 'true'
            - 'false'
          default: 'false'
        constantFields:
          type: string
          description: Values related to target handling in MasterKey. Otherwise obsolete.
        storeOriginal:
          type: string
          description: >-
            Indicates whether to store incoming original record, if supported by the
            job type and the storage configuration.
          enum:
            - 'true'
            - 'false'
          default: 'false'
        currentStatus:
          type: string
          enum:
            - NEW
            - OK
            - WARN
            - ERROR
            - RUNNING
            - FINISHED
            - KILLED
          readOnly: true
          description: Indicates the state of the job. Assigned by API.
        managedBy:
          type: string
          description: >-
            Free-text field for tagging a job with the producer or manager of the
            resource. Multiple tags may be separated by commas. The tags can be used
            for filtering status reports by job administrators for example.
        usedBy:
          type: string
          description: >-
            Free form administrative information; could be tags for the clients using
            this harvestable.
        serviceProvider:
          type: string
          description: Free-text field for administrative information about the harvest job.
        contactNotes:
          type: string
          description: Free form text field for administrator's notes.
        technicalNotes:
          type: string
          description: Free-text field for administrative information.
        logLevel:
          type: string
          description: >-
            Specifies the logging level for the job with TRACE being the most
            (extremely) verbose. INFO is the recommended log level in most cases.
          enum:
            - ERROR
            - WARN
            - INFO
            - DEBUG
            - TRACE
        failedRecordsLogging:
          type: string
          description: >-
            Specify whether or not failed records should be saved as XML files in a
            designated log directory. Also specifies retention policy for the
            directory, that is, whether to retain files that were saved in previous
            runs (CLEAN_DIRECTORY = don't retain) and, if so, whether to overwrite any
            existing files if the same record fails again (CREATE_OVERWRITE) or rather
            add a sequence number to the new file name in order not to overwrite
            (ADD_ALL).
          enum:
            - NO_STORE
            - CLEAN_DIRECTORY
            - CREATE_OVERWRITE
            - ADD_ALL
          default: CLEAN_DIRECTORY
        maxSavedFailedRecordsPerRun:
          type: string
          description: >-
            Sets a maximum number of files to save in the failed records directory per
            run. The job log will tell when the limit is reached.
          pattern: '^[0-9]*$'
          default: '100'
        maxSavedFailedRecordsTotal:
          type: string
          description: >-
            Sets a maximum number of files to be saved in the failed records directory
            at any given time - as the sum of previously saved records (that were not
            cleaned up before this run) plus any new records added during the run.The
            job log will tell when the limit is reached.
          pattern: '^[0-9]*$'
          default: '1000'
        mailAddress:
          type: string
          description: >-
            Comma separated list of e-mail addresses that should receive notification
            on job completion.
        mailLevel:
          type: string
          description: >-
            The minimum severity of a job's completion status that will trigger email
            notification.
          enum:
            - OK
            - WARN
            - ERROR
        lastHarvestFinished:
          type: string
          description: >-
            Assigned by API. The date and time when the most recent harvest job with
            this configuration completed.
        lastHarvestStarted:
          type: string
          description: >-
            Assigned by API. The date and time when the most recent harvest job with
            this configuration began.
        lastUpdated:
          type: string
          description: Assigned by API. The date and time when this definition was last modified.
        nextHarvestSchedule:
          type: string
          description: >-
            The date and time when a job with this definition should be run (if job is
            enabled).
        amountHarvested:
          type: string
          description: >-
            Assigned by API. Number of records harvested in last run. It seems this
            should really be an integer, but string is what the WSAPI gives us.
          pattern: '^[0-9]*$'
        message:
          type: string
          description: Assigned by API. Message summarising results of last run.
        acl:
          type: string
          description: Assigned by API. Name of the tenant that created the configuration record.
          readOnly: true
      oneOf:
        - properties:
            type:
              type: string
              enum:
                - oaiPmh
              description: Indicates OAI-PMH job.
            metadataPrefix:
              type: string
              description: >-
                OAI-PMH only. The metadata prefix supported by the OAI-PMH service to
                harvest from.
            oaiSetName:
              type: string
              description: >-
                OAI-PMH only. The name of a record set offered by the OAI-PMH service
                to harvest from.
            resumptionToken:
              type: string
              description: OAI-PMH only. PMH identifier for fetching the next batch of records.
            retryCount:
              type: string
              description: >-
                Indicates how many times Harvester should retry a failed OAI-PMH
                request.
              pattern: '^[0-9]*$'
              default: '2'
            retryWait:
              type: string
              description: >-
                Indicates how many seconds Harvester should wait before retrying a
                failed OAI-PMH request.
              pattern: '^[0-9]*$'
              default: '60'
          required:
            - metadataPrefix
            - oaiSetName
        - properties:
            type:
              type: string
              enum:
                - xmlBulk
              description: Indicates bulk XML job.
            allowErrors:
              type: string
              description: Whether or not to continue despite harvest record errors.
              default: 'false'
              enum:
                - 'true'
                - 'false'
            overwrite:
              type: string
              description: >-
                Applies to storages that supports this (Solr, not FOLIO Inventory).
                Will delete all previously harvested data before beginning the next
                scheduled (or manually triggered) run, if set to true.
              enum:
                - 'true'
                - 'false'
            allowCondReq:
              type: string
              description: Whether or not to filter on file date to only harvest new XML files
              enum:
                - 'true'
                - 'false'
              default: 'false'
            fromDate:
              type: string
              description: >-
                Initial start date (yyyy-MM-dd) for incremental updates (when
                allowConfReq is 'true')
            csvConfiguration:
              type: string
              description: >-
                Semicolon-separated key-value pairs that specifies parsing of a CSV
                file into XML for further processing (see Harvester documentation for
                details).
            excludeFilePattern:
              type: string
              description: >-
                Regular expression; setting to skip harvesting of files with names
                matching the given regular expression (see Harvester documentation for
                details).
            expectedSchema:
              type: string
              description: 'Mime-type override (e.g: application/marc; charset=MARC-8).'
            includeFilePattern:
              type: string
              description: >-
                Regular expression; setting to request harvesting of files with names
                matching the given regular expression unless those file names are
                simultaneously excluded by the excludeFilePattern. .zip, .gz, .tar
                included by default unless explicitly excluded by excludeFilePattern
                (see Harvester documentation for details).
            outputSchema:
              type: string
              description: >-
                MARC XML transformation format (application/marc or
                application/tmarc).
            passiveMode:
              type: string
              description: Whether or not to use passive mode for FTP transfers.
              enum:
                - 'true'
                - 'false'
              default: 'false'
            recurse:
              type: string
              description: >-
                Whether or not to recurse into sub-folders in the source directory
                tree.
              enum:
                - 'true'
                - 'false'
              default: 'false'
            splitAt:
              type: string
              description: >-
                Level/depth to split XML files at to extract records. Zero/empty
                disables split.
              pattern: '^[0-9]*$'
            splitSize:
              type: string
              description: >-
                Setting to split large XML files into chunks of `splitSize' number of
                records; to preserve memory during XSLT transformations.
              pattern: '^[0-9]*$'
      required:
        - name
        - type
        - enabled
        - harvestImmediately
        - storage
        - transformation
        - url


    harvestablePostPut:
      description: A harvest job definition
      type: object
      oneOf:
        - $ref: "#/components/schemas/harvestableXmlBulkPostPut"
        - $ref: "#/components/schemas/harvestableOaiPmhPostPut"
        - $ref: "#/components/schemas/harvestableConnectorPostPut"

    harvestableXmlBulkPostPut:
      description: A XML bulk harvest job definition
      type: object
      properties:
        id:
          type: string
          description: >-
            Unique, numeric ID for the job definition. Will be assigned if not
            provided.
          pattern: '^[0-9]*$'
        name:
          type: string
          description: The name assigned to the harvest configuration.
        description:
          type: string
          description: Free form description of the configuration to support the administration.
        openAccess:
          type: string
          description: tbd
          enum:
            - 'true'
            - 'false'
        storage:
          type: object
          description: Reference to the storage configuration to use.
          anyOf:
            - properties:
                id:
                  type: string
                  description: Reference to the ID of the storage engine to use.
              required:
                - id
            - properties:
                name:
                  type: string
                  description: >-
                    Used for look-up by name as an alternative to reference by id (id
                    will be used if present).
              required:
                - name
        transformation:
          type: object
          description: Reference to the transformation pipeline to use.
          anyOf:
            - properties:
                id:
                  type: string
                  description: Reference to the ID of the transformation pipeline to apply.
                  pattern: '^[0-9]*$'
              required:
                - id
            - properties:
                name:
                  type: string
                  description: >-
                    Used for look-up by name as an alternative to reference by ID (id
                    will be used if present).
              required:
                - name
        enabled:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Indicates if the job is scheduled for running
        harvestImmediately:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Whether to harvest when the config is persisted.
        scheduleString:
          type: string
          description: >-
            Crontab style schedule string (simplified): minute(0-59) hour(0-24)  day
            of month(* or 1-31)  month (* or 1-12)  day of week (* or 0-6).
        dateFormat:
          type: string
          description: 'For example yyyy-MM-dd''T''hh:mm:ss''Z''.'
        url:
          type: string
          description: The URL to access the data from.
        timeout:
          type: string
          description: >-
            Connection/read timeout in seconds; application depending on the specific
            protocol used for fetching data.
          pattern: '^[0-9]*$'
          default: '300'
        cacheEnabled:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Whether or not to store incoming records in Harvester's file system.
        diskRun:
          type: string
          enum:
            - 'true'
            - 'false'
          description: >-
            Whether or not to run harvest job from records cached in a previous job
            run.
        storageBatchLimit:
          type: string
          description: 'Batch size: Number of records to send to storage at a time.'
          pattern: '^[0-9]*$'
        recordLimit:
          type: string
          description: Maximum number of records to harvest.
          pattern: '^[0-9]*$'
        laxParsing:
          type: string
          description: >-
            When enabled, Harvester will attempt to parse malformed XML (missing
            closing tags, entities)
          enum:
            - 'true'
            - 'false'
          default: 'false'
        constantFields:
          type: string
          description: Values related to target handling in MasterKey. Otherwise obsolete.
        storeOriginal:
          type: string
          description: >-
            Indicates whether to store incoming original record, if supported by the
            job type and the storage configuration.
          enum:
            - 'true'
            - 'false'
          default: 'false'
        currentStatus:
          type: string
          enum:
            - NEW
            - OK
            - WARN
            - ERROR
            - RUNNING
            - FINISHED
            - KILLED
          readOnly: true
          description: Indicates the state of the job. Assigned by API.
        managedBy:
          type: string
          description: >-
            Free-text field for tagging a job with the producer or manager of the
            resource. Multiple tags may be separated by commas. The tags can be used
            for filtering status reports by job administrators for example.
        usedBy:
          type: string
          description: >-
            Free form administrative information; could be tags for the clients using
            this harvestable.
        serviceProvider:
          type: string
          description: Free-text field for administrative information about the harvest job.
        contactNotes:
          type: string
          description: Free form text field for administrator's notes.
        technicalNotes:
          type: string
          description: Free-text field for administrative information.
        logLevel:
          type: string
          description: >-
            Specifies the logging level for the job with TRACE being the most
            (extremely) verbose. INFO is the recommended log level in most cases.
          enum:
            - ERROR
            - WARN
            - INFO
            - DEBUG
            - TRACE
        failedRecordsLogging:
          type: string
          description: >-
            Specify whether or not failed records should be saved as XML files in a
            designated log directory. Also specifies retention policy for the
            directory, that is, whether to retain files that were saved in previous
            runs (CLEAN_DIRECTORY = don't retain) and, if so, whether to overwrite any
            existing files if the same record fails again (CREATE_OVERWRITE) or rather
            add a sequence number to the new file name in order not to overwrite
            (ADD_ALL).
          enum:
            - NO_STORE
            - CLEAN_DIRECTORY
            - CREATE_OVERWRITE
            - ADD_ALL
          default: CLEAN_DIRECTORY
        maxSavedFailedRecordsPerRun:
          type: string
          description: >-
            Sets a maximum number of files to save in the failed records directory per
            run. The job log will tell when the limit is reached.
          pattern: '^[0-9]*$'
          default: '100'
        maxSavedFailedRecordsTotal:
          type: string
          description: >-
            Sets a maximum number of files to be saved in the failed records directory
            at any given time - as the sum of previously saved records (that were not
            cleaned up before this run) plus any new records added during the run.The
            job log will tell when the limit is reached.
          pattern: '^[0-9]*$'
          default: '1000'
        mailAddress:
          type: string
          description: >-
            Comma separated list of e-mail addresses that should receive notification
            on job completion.
        mailLevel:
          type: string
          description: >-
            The minimum severity of a job's completion status that will trigger email
            notification.
          enum:
            - OK
            - WARN
            - ERROR
        initiallyHarvested:
          type: string
          description: 'Date and time, assigned by Harvester'
        lastHarvestFinished:
          type: string
          description: >-
            Assigned by Harvester. The date and time when the most recent harvest job
            with this configuration completed.
        lastHarvestStarted:
          type: string
          description: >-
            Assigned by Harvester. The date and time when the most recent harvest job
            with this configuration began.
        lastUpdated:
          type: string
          description: Assigned by API. The date and time when this definition was last modified.
        nextHarvestSchedule:
          type: string
          description: >-
            The date and time when a job with this definition should be run (if job is
            enabled).
        amountHarvested:
          type: string
          description: >-
            Assigned by API. Number of records harvested in last run. It seems this
            should really be an integer, but string is what the WSAPI gives us.
          pattern: '^[0-9]*$'
        message:
          type: string
          description: Assigned by API. Message summarising results of last run.
        acl:
          type: string
          description: Assigned by API. Name of the tenant that created the configuration record.
          readOnly: true
        type:
          type: string
          enum:
            - xmlBulk
          description: Indicates bulk XML job.
        retryCount:
          type: string
          description: Obsolete but allowed for XML bulk.
          pattern: '^[0-9]*$'
          default: '2'
        retryWait:
          type: string
          description: Obsolete but allowed for XML bulk.
          pattern: '^[0-9]*$'
          default: '60'
        allowErrors:
          type: string
          description: Whether or not to continue despite harvest record errors.
          default: 'false'
          enum:
            - 'true'
            - 'false'
        allowCondReq:
          type: string
          description: Whether or not to filter on file date to only harvest new XML files
          enum:
            - 'true'
            - 'false'
          default: 'false'
        fromDate:
          type: string
          description: >-
            Initial start date (yyyy-MM-dd) for incremental updates (when allowCondReq
            is 'true')
        csvConfiguration:
          type: string
          description: >-
            Semicolon-separated key-value pairs that specifies parsing of a CSV file
            into XML for further processing (see Harvester documentation for details).
        excludeFilePattern:
          type: string
          description: >-
            Regular expression; setting to skip harvesting of files with names
            matching the given regular expression (see Harvester documentation for
            details).
        expectedSchema:
          type: string
          description: 'Mime-type override (e.g: application/marc; charset=MARC-8).'
        includeFilePattern:
          type: string
          description: >-
            Regular expression; setting to request harvesting of files with names
            matching the given regular expression unless those file names are
            simultaneously excluded by the excludeFilePattern. .zip, .gz, .tar
            included by default unless explicitly excluded by excludeFilePattern (see
            Harvester documentation for details).
        outputSchema:
          type: string
          description: MARC XML transformation format (application/marc or application/tmarc).
        passiveMode:
          type: string
          description: Whether or not to use passive mode for FTP transfers.
          enum:
            - 'true'
            - 'false'
          default: 'false'
        recurse:
          type: string
          description: Whether or not to recurse into sub-folders in the source directory tree.
          enum:
            - 'true'
            - 'false'
          default: 'false'
        splitAt:
          type: string
          description: >-
            Level/depth to split XML files at to extract records. Zero/empty disables
            split.
          pattern: '^[0-9]*$'
        splitSize:
          type: string
          description: >-
            Setting to split large XML files into chunks of `splitSize' number of
            records; to preserve memory during XSLT transformations.
          pattern: '^[0-9]*$'
        json:
          type: object
          description: Custom configurations in JSON format (has no current applications).
        overwrite:
          type: string
          description: >-
            Applies to Solr but not FOLIO Inventory. Will delete all previously
            harvested data before beginning the next scheduled (or manually triggered)
            run, if set to true.
          enum:
            - 'true'
            - 'false'
        keepPartial:
          type: string
          description: >-
            Applies to Solr but not FOLIO Inventory. When true, partial records
            harvested during a failed harvest run will be retained in Solr.
          enum:
            - 'true'
            - 'false'
      required:
        - name
        - type
        - enabled
        - harvestImmediately
        - storage
        - transformation
        - url
      additionalProperties: false

    harvestableOaiPmhPostPut:
      description: A harvest job definition for OAI-PMH records
      type: object
      properties:
        id:
          type: string
          description: >-
            Unique, numeric ID for the job definition. Will be assigned if not
            provided.
          pattern: '^[0-9]*$'
        name:
          type: string
          description: The name assigned to the harvest configuration.
        description:
          type: string
          description: Free form description of the configuration to support the administration.
        openAccess:
          type: string
          description: tbd
          enum:
            - 'true'
            - 'false'
        storage:
          type: object
          description: Reference to the storage configuration to use.
          anyOf:
            - properties:
                id:
                  type: string
                  description: Reference to the ID of the storage engine to use.
              required:
                - id
            - properties:
                name:
                  type: string
                  description: >-
                    Used for look-up by name as an alternative to reference by id (id
                    will be used if present).
              required:
                - name
        transformation:
          type: object
          description: Reference to the transformation pipeline to use.
          anyOf:
            - properties:
                id:
                  type: string
                  description: Reference to the ID of the transformation pipeline to apply.
                  pattern: '^[0-9]*$'
              required:
                - id
            - properties:
                name:
                  type: string
                  description: >-
                    Used for look-up by name as an alternative to reference by ID (id
                    will be used if present).
              required:
                - name
        enabled:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Indicates if the job is scheduled for running
        harvestImmediately:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Whether to harvest when the config is persisted.
        scheduleString:
          type: string
          description: >-
            Crontab style schedule string (simplified): minute(0-59) hour(0-24)  day
            of month(* or 1-31)  month (* or 1-12)  day of week (* or 0-6).
        dateFormat:
          type: string
          description: 'For example yyyy-MM-dd''T''hh:mm:ss''Z''.'
        url:
          type: string
          description: The URL to access the data from.
        timeout:
          type: string
          description: >-
            Connection/read timeout in seconds; application depending on the specific
            protocol used for fetching data.
          pattern: '^[0-9]*$'
          default: '300'
        cacheEnabled:
          type: string
          enum:
            - 'true'
            - 'false'
          description: Whether or not to store incoming records in Harvester's file system.
        diskRun:
          type: string
          enum:
            - 'true'
            - 'false'
          description: >-
            Whether or not to run harvest job from records cached in a previous job
            run.
        storageBatchLimit:
          type: string
          description: 'Batch size: Number of records to send to storage at a time.'
          pattern: '^[0-9]*$'
        recordLimit:
          type: string
          description: Maximum number of records to harvest.
          pattern: '^[0-9]*$'
        laxParsing:
          type: string
          description: >-
            When enabled, Harvester will attempt to parse malformed XML (missing
            closing tags, entities)
          enum:
            - 'true'
            - 'false'
          default: 'false'
        constantFields:
          type: string
          description: Values related to target handling in MasterKey. Otherwise obsolete.
        storeOriginal:
          type: string
          description: >-
            Indicates whether to store incoming original record, if supported by the
            job type and the storage configuration.
          enum:
            - 'true'
            - 'false'
          default: 'false'
        currentStatus:
          type: string
          enum:
            - NEW
            - OK
            - WARN
            - ERROR
            - RUNNING
            - FINISHED
            - KILLED
          readOnly: true
          description: Indicates the state of the job. Assigned by API.
        managedBy:
          type: string
          description: >-
            Free-text field for tagging a job with the producer or manager of the
            resource. Multiple tags may be separated by commas. The tags can be used
            for filtering status reports by job administrators for example.
        usedBy:
          type: string
          description: >-
            Free form administrative information; could be tags for the clients using
            this harvestable.
        serviceProvider:
          type: string
          description: Free-text field for administrative information about the harvest job.
        contactNotes:
          type: string
          description: Free form text field for administrator's notes.
        technicalNotes:
          type: string
          description: Free-text field for administrative information.
        logLevel:
          type: string
          description: >-
            Specifies the logging level for the job with TRACE being the most
            (extremely) verbose. INFO is the recommended log level in most cases.
          enum:
            - ERROR
            - WARN
            - INFO
            - DEBUG
            - TRACE
        failedRecordsLogging:
          type: string
          description: >-
            Specify whether or not failed records should be saved as XML files in a
            designated log directory. Also specifies retention policy for the
            directory, that is, whether to retain files that were saved in previous
            runs (CLEAN_DIRECTORY = don't retain) and, if so, whether to overwrite any
            existing files if the same record fails again (CREATE_OVERWRITE) or rather
            add a sequence number to the new file name in order not to overwrite
            (ADD_ALL).
          enum:
            - NO_STORE
            - CLEAN_DIRECTORY
            - CREATE_OVERWRITE
            - ADD_ALL
          default: CLEAN_DIRECTORY
        maxSavedFailedRecordsPerRun:
          type: string
          description: >-
            Sets a maximum number of files to save in the failed records directory per
            run. The job log will tell when the limit is reached.
          pattern: '^[0-9]*$'
          default: '100'
        maxSavedFailedRecordsTotal:
          type: string
          description: >-
            Sets a maximum number of files to be saved in the failed records directory
            at any given time - as the sum of previously saved records (that were not
            cleaned up before this run) plus any new records added during the run.The
            job log will tell when the limit is reached.
          pattern: '^[0-9]*$'
          default: '1000'
        mailAddress:
          type: string
          description: >-
            Comma separated list of e-mail addresses that should receive notification
            on job completion.
        mailLevel:
          type: string
          description: >-
            The minimum severity of a job's completion status that will trigger email
            notification.
          enum:
            - OK
            - WARN
            - ERROR
        lastHarvestFinished:
          type: string
          description: >-
            Assigned by API. The date and time when the most recent harvest job with
            this configuration completed.
        initiallyHarvested:
          type: string
          description: Date and time, assigned by Harvester
        lastHarvestStarted:
          type: string
          description: >-
            Assigned by Harvester. The date and time when the most recent harvest job
            with this configuration began.
        lastUpdated:
          type: string
          description: >-
            Assigned by Harvester. The date and time when this definition was last
            modified.
        nextHarvestSchedule:
          type: string
          description: >-
            The date and time when a job with this definition should be run (if job is
            enabled).
        amountHarvested:
          type: string
          description: >-
            Assigned by API. Number of records harvested in last run. It seems this
            should really be an integer, but string is what the WSAPI gives us.
          pattern: '^[0-9]*$'
        message:
          type: string
          description: Assigned by API. Message summarising results of last run.
        acl:
          type: string
          description: Assigned by API. Name of the tenant that created the configuration record.
          readOnly: true
        type:
          type: string
          enum:
            - oaiPmh
          description: Indicates OAI-PMH job.
        metadataPrefix:
          type: string
          description: >-
            OAI-PMH only. The metadata prefix supported by the OAI-PMH service to
            harvest from.
        oaiSetName:
          type: string
          description: >-
            OAI-PMH only. The name of a record set offered by the OAI-PMH service to
            harvest from.
        resumptionToken:
          type: string
          description: OAI-PMH only. PMH identifier for fetching the next batch of records.
        clearRtOnError:
          type: string
          description: >-
            Clear the resumption token for harvests that complete in an error state.
            This is useful when server errors out and the last resumption token is no
            longer valid.
          enum:
            - 'true'
            - 'false'
          default: 'false'
        fromDate:
          type: string
          description: >-
            yyyy-MM-dd. If empty and no resumption token is set, the Harvester will
            harvest the full data set from the resource. When this field contains a
            value, upon completion of the job the Harvester will reset the value of
            this field to the day prior to the current run date, so subsequent runs
            will harvest only new records.
        untilDate:
          type: string
          description: >-
            yyyy-MM-dd. Upper date limit for selective harvesting. On consecutive runs
            the Harvester will clear this field making the date interval open-ended.
        retryCount:
          type: string
          description: Indicates how many times Harvester should retry a failed OAI-PMH request.
          pattern: '^[0-9]*$'
          default: '2'
        retryWait:
          type: string
          description: >-
            Indicates how many seconds Harvester should wait before retrying a failed
            OAI-PMH request.
          pattern: '^[0-9]*$'
          default: '60'
        allowErrors:
          type: string
          description: NA for OAI-PMH
          default: 'false'
          enum:
            - 'true'
            - 'false'
        json:
          type: object
          description: Custom configurations in JSON format (has no current applications).
        overwrite:
          type: string
          description: >-
            Applies to Solr but not FOLIO Inventory. Will delete all previously
            harvested data before beginning the next scheduled (or manually triggered)
            run, if set to true.
          enum:
            - 'true'
            - 'false'
        keepPartial:
          type: string
          description: >-
            Applies to Solr but not FOLIO Inventory. When true, partial records
            harvested during a failed harvest run will be retained in Solr.
          enum:
            - 'true'
            - 'false'
      required:
        - name
        - type
        - enabled
        - harvestImmediately
        - storage
        - transformation
        - url
        - metadataPrefix
        - oaiSetName
      additionalProperties: false

    harvestableConnectorPostPut:
      description: A connector harvest job definition (XXX only validates type)
      type: object
      properties:
        type:
          type: string
          enum:
            - connector
          description: Indicates bulk XML job.
      required:
        - type
      additionalProperties: true

    failedRecordsCurrentJob:
      description: Set of failed-records error reports
      type: object
      properties:
        failedRecords:
          description: >-
            List of failed records created by the most recent run of a harvest
            configuration.
          type: array
          items:
            type: object
            $ref: "#/components/schemas/failedRecordCurrentJob"

    failedRecordCurrentJob:
      description: >-
        An error report about an Inventory record set that had one or more errors
        during upsert or delete.
      type: object
      properties:
        recordErrors:
          type: array
          description: List of errors encountered during upsert or delete.
          items:
            type: object
            description: Report of an error encountered during upsert or delete.
            properties:
              error:
                type: object
                description: The error object
                properties:
                  label:
                    type: string
                    description: Short context description
                  typeOfError:
                    type: string
                    description: Error category.
                  typeOfRecord:
                    type: string
                    description: >-
                      The type of entity affected by the error, i.e.
                      'HOLDINGS_RECORD'.
                  transaction:
                    type: string
                    description: The type of transaction performed when the error occurred.
                  message:
                    type: object
                    description: >-
                      Error message produced by the backend component reporting the
                      error.
                  entity:
                    type: object
                    description: >-
                      The JSON object entity that encountered an error - ie. a
                      holdingsRecord JSON.
        original:
          type: string
          description: >-
            I.e. the XML of the incoming record before transformation to an Inventory
            record set.
        transformedRecord:
          type: object
          description: The JSON outcome of the transformation of the original record.
        timeStamp:
          type: string
          description: The time the error occurred, Day Mon DD HH24:mi:ss TZ yyyy
        recordNumber:
          type: string
          description: The identifier assigned to this error report by Harvester
        harvestableId:
          type: string
          description: >-
            The numeric identifier for the harvest job configuration that was running
            the job in which the error occurred.

    previousJobs:
      description: Result set of previous harvest job runs.
      type: object
      properties:
        previousJobs:
          description: List of previous jobs
          type: array
          items:
            type: object
            $ref: "#/components/schemas/previousJob"

    previousJob:
      description: >-
        Select settings (all read-only) from a Harvest configuration, populated to log
        the settings of a previous harvest job.
      type: object
      properties:
        id:
          description: unique identifier for this report of a single harvest run - a UUID
          type: string
        name:
          description: >-
            The name of the harvest configuration at the time of logging the harvest
            run.
          type: string
        harvestableId:
          description: Unique identifier for the harvest configuration.
          type: integer
        type:
          description: The type of harvest job (bulk XML or OAI-PMH)
          type: string
        url:
          description: >-
            The URL(s) used for retrieving the records that were harvested during this
            job.
          type: string
        allowErrors:
          description: >-
            Indicates whether the job was configured to continue in case of (certain
            classes of) errors.
          type: boolean
        recordLimit:
          description: >-
            Indicates the limit -- if any -- on the maximum number of records to load
            according to the configuration.
          type: integer
        transformation:
          description: The name of the transformation pipeline that was used for the harvest job.
          type: string
        storage:
          description: >-
            The name of the storage that was used for persisting the records harvested
            during the job.
          type: string
        status:
          description: >-
            The outcome of the job. This would usually be the status after the job
            finished but it's possible to retrieve a history entry for a still running
            job.
          type: string
        started:
          description: Timestamp indicating when the job began.
          type: string
        finished:
          description: Timestamp indicating when the job completed.
          type: string
        amountHarvested:
          description: The number of (incoming) records that were processed.
          type: integer
        message:
          description: >-
            A description of the outcome of the harvest job, for example update
            statistics or a fatal error.
          type: string

    failedRecordsPreviousJob:
      description: Set of failed-records error reports
      type: object
      properties:
        failedRecords:
          description: List of failed records created by a previous harvest job run.
          type: array
          items:
            type: object
            $ref: "#/components/schemas/failedRecordPreviousJob"

    failedRecordPreviousJob:
      description: >-
        An error report about an Inventory record set that had one or more errors
        during upsert or delete.
      type: object
      properties:
        id:
          description: Unique ID (uuid) for this error report.
          type: string
        harvestJobId:
          description: Identifier (uuid) of the harvest job run creating the error report
          type: string
        harvestableId:
          description: >-
            Identifier (numeric) of the harvest configuration (harvestable), by which
            the job was run.
          type: integer
        harvestableName:
          description: Name of the harvest configuration (harvestable), by which the job was run.
          type: string
        recordErrors:
          type: array
          description: List of errors encountered during upsert or delete.
          items:
            type: object
            description: Report of an error encountered during upsert or delete.
            properties:
              error:
                type: object
                description: The error object
                properties:
                  label:
                    type: string
                    description: Short context description
                  typeOfError:
                    type: object
                    description: Error category.
                  typeOfRecord:
                    type: string
                    description: >-
                      The type of entity affected by the error, i.e.
                      'HOLDINGS_RECORD'.
                  transaction:
                    type: string
                    description: The type of transaction performed when the error occurred.
                  message:
                    type: object
                    description: >-
                      Error message produced by the backend component reporting the
                      error.
                  entity:
                    type: object
                    description: >-
                      The JSON object entity that encountered an error - ie. a
                      holdingsRecord JSON.
        original:
          type: string
          description: >-
            I.e. the XML of the incoming record before transformation to an Inventory
            record set.
        transformedRecord:
          type: object
          description: The JSON outcome of the transformation of the original record.
        timeStamp:
          type: string
          description: The time the error occurred, Day Mon DD HH24:mi:ss TZ yyyy
        recordNumber:
          type: string
          description: The identifier assigned to this error report by Harvester

    logLines:
      description: Harvest job log statements as JSON.
      type: object
      properties:
        logLines:
          description: Collection of Log4J log statements.
          type: array
          items:
            type: object
            $ref: "#/components/schemas/logLine"

    logLine:
      description: A single log4j log statement from a harvest job.
      type: object
      properties:
        id:
          description: Unique identifier (UUID) for the log line.
          type: string
        timeStamp:
          description: Date and time the log statement was created.
          type: string
        logLevel:
          description: The log4j log level (INFO, DEBUG, etc).
          type: string
        jobLabel:
          description: Harvester's identification of the job that created the log line.
          type: string
        line:
          description: The logged statement.
          type: string

    jobStarted:
      description: Response to confirm that a harvest job was started
      type: object
      properties:
        harvestableId:
          type: integer
          description: >-
            The unique ID of the harvest configuration, where the job status can be
            monitored
        name:
          type: string
          description: name of the harvest job configuration
        initiated:
          type: string
          description: date and time this job request was sent to Harvester
      additionalProperties: false

    jobStopped:
      description: Response to confirm that a harvest job was stopped
      type: object
      additionalProperties: true

    harvestJobStatus:
      description: Status of finished harvest job.
      type: object
      properties:
        status:
          type: string
          description: The outcome of the harvester job according to Harvester.
          enum:
            - NEW
            - OK
            - WARN
            - ERROR
            - RUNNING
            - FINISHED
            - KILLED
        finished:
          type: string
          description: ISO formatted timestamp for when the job finished.
        started:
          type: string
          description: ISO formatted timestamp for when the job started.
        amountHarvested:
          type: string
          description: The number of records harvested in the harvest run.
        message:
          type: string
          description: Status message for the outcome of the harvest run.
      additionalProperties: false
      required:
        - status
        - message
